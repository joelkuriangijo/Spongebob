<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CodeSphere Meeting | {{ room_id }}</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/material-darker.min.css">
  <style>
    #editor-area { display: none; }
    .meeting-container.editor-visible #editor-area { display: flex; flex: 2; }
    .meeting-container.editor-visible #video-area { flex: 3; }
    #video-area { flex: 1; }
    #join-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.85); display: flex; justify-content: center; align-items: center; z-index: 1000; }
    #join-overlay div { text-align: center; }
    #join-overlay h2 { margin-bottom: 20px; }
  </style>
</head>
<body>
  <div id="join-overlay">
    <div>
      <h2>You're about to join the meeting</h2>
      <button id="join-btn" class="btn">Join Call & Start Camera</button>
    </div>
  </div>
  <nav class="meeting-navbar">
    <div class="nav-left">
      <button onclick="window.location.href='/home'" class="btn-red">End Call</button>
      <button id="toggleVideoBtn" class="btn">Video On</button>
      <button id="toggleAudioBtn" class="btn">Audio On</button>
      {% if user_role == 'teacher' %}
        <button id="toggleEditorBtn" class="btn">Show Editor</button>
      {% endif %}
    </div>

    <div class="nav-center" style="display: flex; align-items: center; gap: 15px;">
      <span>Meeting ID: <span id="meetingIdDisplay">{{ room_id }}</span></span>
      <button id="copyLinkBtn" class="btn" style="padding: 5px 10px;">Copy Link</button>
    </div>
    
    <div class="nav-right">
      </div>
</nav>
  <div id="main-container" class="meeting-container">
    <div id="video-area">
      <div class="video-wrapper">
        <video id="myVideo" autoplay muted></video>
        <div class="video-label">You ({{ user.name }})</div>
      </div>
      <div id="remoteVideos"></div>
    </div>
    <div id="editor-area">
      <textarea id="codeEditor"></textarea>
      <div class="output-controls" style="display: flex; padding: 5px;">
        <button id="runBtn" class="btn">Run Code</button>
        <pre id="output" style="flex-grow: 1; margin: 0 0 0 10px; background: #121212; padding: 8px; border-radius: 4px; white-space: pre-wrap; word-break: break-all;"></pre>
      </div>
    </div>
  </div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/python/python.min.js"></script>
  <script>
    const ROOM_ID = "{{ room_id }}";
    const USER_ROLE = "{{ user_role }}";
  </script>
  <script src="{{ url_for('static', filename='js/socket.js') }}"></script>
  <script src="{{ url_for('static', filename='js/video.js') }}"></script>
  <script src="{{ url_for('static', filename='js/editor.js') }}"></script>
  <script src="{{ url_for('static', filename='js/ui.js') }}"></script>
</body>
</html>